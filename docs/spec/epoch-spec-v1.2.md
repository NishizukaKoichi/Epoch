# Epoch 技術仕様書
Version 1.2
Status: Final / Implementation-Complete Spec

## 1. 基本定義

Epoch は、人の判断と行為を  
評価・解釈・最適化せず、  
**不可逆な時間の層として記録・保存するプロダクト**である。

Epoch が扱うのは  
「事実が起きたこと」  
「起きなかったこと」  
のみであり、意味づけは時間に委ねられる。

## 2. 絶対原則

以下は破ってはならない。

・履歴は削除できない  
・履歴は書き換えられない  
・時間順序は絶対  
・評価・スコア・要約を行わない  
・沈黙も履歴として扱う  
・クライアントの違いで意味が変わらない

UX、成長、利便性は  
これらを侵害しない限りにおいてのみ許可される。

## 3. クライアント前提（Web / Mobile 共通）

Epoch における真実は、常にサーバ側にのみ存在する。

・Web クライアント  
・Mobile クライアント（PWA / ネイティブ想定）

いずれも  
入力と閲覧のための端末であり、  
履歴の意味や状態を保持しない。

ローカルに許可されるのは  
・下書き（draft）のみ

## 4. システム構成（論理）

Client Layer  
・Web UI  
・Mobile UI  
・下書きローカル保持

Application Layer  
・認証  
・EpochRecord 書き込み制御  
・可視性制御  
・読み取り課金制御  
・署名検証

Persistence Layer  
・不可逆 Record Store  
・Record Index  
・プロフィール表層データ  
・課金／購読情報  
・監査ログ

分析、推薦、通知基盤は原則持たない。

## 5. ユーザーと認証

### 5.1 User の定義

User は人格ではなく  
**履歴の主体**である。

User が持つ属性  
・user_id（UUIDv7 推奨）  
・created_at  
・auth_credentials

複数 User の統合は禁止。

### 5.2 認証方式

・Passkey（WebAuthn）を第一優先  
・Email + Magic Link は補助  
・OAuth は原則使用しない

スマホでは OS 認証器（Face ID / Touch ID 等）を利用可能。

認証は本人確認のためだけに存在し、  
評価や信頼付与には使われない。

### 5.3 認証復旧

・ログイン状態でのみ passkey 追加可  
・ログイン不能時はメール復旧のみ  
・復旧が行われた事実は EpochRecord として記録  
・運営者の手動介入は禁止

## 6. EpochRecord（不可逆履歴）

### 6.1 基本構造

EpochRecord は不可変イベント。

必須フィールド  
・record_id  
・user_id  
・recorded_at（UTC、サーバ時刻のみ）  
・record_type  
・payload  
・prev_hash  
・record_hash

クライアント時刻は使用しない。

### 6.2 record_type（初期固定）

・decision_made  
・decision_not_made  
・invited  
・declined  
・revised  
・period_of_silence  
・auth_recovered

追加は可能だが、意味変更は禁止。

### 6.3 payload 制約

payload は JSON。

禁止  
・評価語、感情語  
・成功／失敗判定  
・他 record の意味を書き換える参照

payload は事実の記述に限定。

## 7. 画像・メディア添付

### 7.1 Record 添付画像

・画像は EpochRecord に付随する attachment としてのみ存在  
・テキスト payload を必須とする  
・画像単体 record の作成は禁止

技術制約  
・immutable storage（差し替え不可）  
・attachment_hash を record_hash に含める  
・EXIF 時刻は信用しない

画像は証拠補助であり、意味を定義しない。

### 7.2 動画

v1 では禁止。

## 8. プロフィール情報（表層データ）

### 8.1 プロフィール画像

・デフォルトは認証アカウント由来の avatar  
・取得不可の場合は抽象プレースホルダー  
・ユーザーは任意で画像変更可能

制約  
・EpochRecord を生成しない  
・変更履歴を残さない  
・評価、検索、課金に関与しない  
・record_hash とは無関係

プロフィール画像は  
**履歴を持たない表層データ**である。

### 8.2 その他プロフィール

・表示名（mutable）  
・短い自己紹介（任意）

いずれも履歴性を持たない。

## 9. 公開範囲制御

各 record は以下の可視性を持つ。

・private  
・scout_visible（URL 保持者）  
・public

可視性変更は状態変更 record として追記され、  
過去は書き換えない。

## 10. オフライン動作

・オフライン確定は禁止  
・オフライン下書きのみ許可  
・確定は常にオンラインかつサーバ時刻

## 11. 読み取りと課金

### 11.1 課金対象

・自分の Epoch 閲覧は無料  
・他人の Epoch を判断材料として読む場合のみ課金

### 11.2 課金単位

許可  
・Time Window  
・Read Session

禁止  
・Record 単体課金  
・評価連動課金

### 11.3 無料復帰

課金停止後も  
・書き込み  
・自己閲覧  
は継続可能。

## 12. スカウト機構

スカウトは Epoch 外部イベント。

文言固定  
「一回来て、仕事を一緒にやってみませんか？」

自由記述は禁止。

送信、受信、承諾、拒否は  
双方の Epoch に事実として記録される。

## 13. 通知方針

原則通知なし。  
例外としてスカウト受信のみ通知可。

## 14. 禁止事項

以下は実装しない。

・全文検索  
・AI 要約  
・ランキング  
・スコア  
・おすすめ

意味の圧縮は評価を生むため。

## 15. 監査と運営権限

・全操作は監査ログに記録  
・運営者操作も同様  
・運営者は record の削除・修正不可

## 16. 終了とデータエクスポート

サービス終了時  
・全履歴をそのままエクスポート可能  
・意味変換、再構成は禁止

Epoch は消える前提で設計される。

## 17. 実装完了定義（最終）

以下を満たした時点で Epoch v1 は完成とする。

・不可逆 Record 書き込みが稼働  
・Web / Mobile が同一仕様で動作  
・オフラインは draft のみ  
・画像添付が record に従属して機能  
・プロフィール画像は表層データとして分離  
・読み取り課金が機能  
・削除／編集 API が存在しない  
・運営者でも履歴改変不可

――――――――――  
価値定義ドキュメント：Epoch  
――――――――――

## 1. 誰が（Who）

・判断や行為の履歴が、  
　評価・印象・物語に歪められる環境に身を置いてきた人  
・採用、協業、信頼形成などで  
　「説明」や「自己演出」に疲弊している人  
・自分の過去を、良くも悪くも“正当化せずに”残したい人

肩書きや属性は問わない。  
共通しているのは、  
「語るより、残したい」という動機のみ。

## 2. どの状況で（When）

・過去の判断や行動について  
　説明や評価を求められた瞬間  
・沈黙や見送った選択が  
　「なかったこと」にされそうになった瞬間  
・相手の言葉や実績ではなく  
　時間の積み重なりそのものを  
　判断材料として見たい／見せたい瞬間

この時点では  
信頼はまだ成立していない。  
だからこそ、解釈が入る余地が問題になる。

## 3. 何に困っているか（Problem）

・履歴が、後から編集・要約・物語化されてしまう  
・語らなかったこと、選ばなかったことが記録に残らない  
・評価やスコアに変換された瞬間に  
　文脈と時間が失われる  
・「自分の判断を、他人の言葉で説明される」ことへの不信

無料のログやノートでは  
この問題は解消されない。  
なぜなら、  
意味付けと最適化が必ず侵入するため。

## 4. なぜ今解決しないといけないか（Why Now）

・AI による要約・評価・推薦が  
　あらゆる履歴を“圧縮”し始めている  
・沈黙や未選択は  
　今後ますます可視化されなくなる  
・後から「事実だけ」を取り戻すことは不可能

時間は不可逆であり、  
記録しなかった事実は  
永遠に存在しない。

## 5. Epoch が提供する価値（Value）

Epoch は  
判断と行為を  
解釈せず、評価せず、最適化せず、  
不可逆な時間の層として記録する。

提供されるのは  
・起きたこと  
・起きなかったこと  
だけ。

意味は、未来に委ねられる。  
そのために、  
今は不便で、語れなくて、静かな構造を選ぶ。

## 6. 支払いが発生する瞬間（Payment Trigger）

ユーザーが支払いを決断するのは  
「他人の Epoch を、判断材料として読む」瞬間。

そのときユーザーは  
・要約されていないこと  
・評価が混ざっていないこと  
・編集不可能であること  
・沈黙が欠損していないこと  
に、明確な価値を感じている。

無料では  
その確実性は担保されない。

## 7. なぜお金を払うのが合理的か（Rationale）

・判断を誤った場合のコストが高すぎる  
・語られた物語より、時間の事実の方が信頼できる  
・「読まない自由」ではなく  
　「歪められていない履歴を読む権利」に対価を払っている

支払いは  
情報量ではなく、  
**不確実性の除去**に対して行われる。

――――――――――

――――――――――  
課題→価値→支払い理由対応表：Epoch  
――――――――――

## 1. 課題  
判断や行為の履歴が、後から編集・要約・物語化されてしまう

・対応する価値  
　履歴を不可逆な Record として保存し、削除・修正・要約を技術的に不可能にする

・支払い理由  
　無料のログやノートでは「後から整える自由」が残る  
　判断材料として使う以上、その自由はノイズになる  
　編集不能であること自体に対価を払うのは合理的

## 2. 課題  
語らなかったこと、選ばなかった判断が履歴に残らない

・対応する価値  
　decision_not_made や period_of_silence を正式な Record として扱い、  
　沈黙や不在を欠損として扱わない構造を提供する

・支払い理由  
　沈黙が消えている履歴は、事後的に必ず歪む  
　重要な判断ほど「何をしなかったか」に価値がある  
　その欠損が無いことを確認できるなら、支払う合理性がある

## 3. 課題  
評価・スコア・推薦によって、履歴の意味が固定されてしまう

・対応する価値  
　評価・要約・ランキング・おすすめを一切持たない設計により、  
　意味付けを未来と読み手に完全に委ねる

・支払い理由  
　判断前に意味を押し付けられないことは、  
　高コストな意思決定において明確な価値になる  
　評価されていないこと自体が、信頼条件になる

## 4. 課題  
クライアントや表示環境によって、履歴の解釈が変わる

・対応する価値  
　真実は常にサーバ側にのみ存在し、  
　時刻・順序・内容は一意に確定される

・支払い理由  
　環境差で意味が揺れる履歴は、判断材料として使えない  
　同一の事実を前提に判断できるなら、対価を払う理由になる

## 5. 課題  
画像や証拠が、文脈を上書きしてしまう

・対応する価値  
　画像は必ず Record に従属させ、  
　単体では存在できない証拠補助としてのみ扱う

・支払い理由  
　証拠が意味を語り始めた瞬間に、履歴は物語になる  
　意味を定義しない証拠構造が保証されているなら、  
　安心して読むために支払える

## 6. 課題  
「読むこと」と「評価すること」が混同される

・対応する価値  
　課金を「他人の Epoch を判断材料として読む行為」に限定し、  
　Record 単体や評価連動の価格設計を排除する

・支払い理由  
　読んだ結果ではなく、  
　歪められていない履歴にアクセスする行為そのものに  
　対価を支払っていると明確に理解できる

――――――――――

――――――――――  
MVP機能定義ドキュメント：Epoch v1  
――――――――――

前提  
この MVP は  
早く広げるための縮小版ではない。  
価値が壊れない限界点を、そのまま形にしたものになる。

## 1. 不可逆 EpochRecord 書き込み機構

・機能内容  
　EpochRecord をサーバ時刻で確定し、  
　削除・編集・並び替えを不可能にする書き込み機構

・なぜ必要か  
　これが無い Epoch は、ただのログアプリになる  
　不可逆であることが価値の核そのもの

・無いと何が起きるか  
　後から直せる前提が生まれ、  
　すべての記録が「暫定」になる

・後回しにしなかった理由  
　不可逆性は追加できない  
　最初から無いと、後で導入しても信用は回復しない

## 2. record_type 固定と意味変更禁止

・機能内容  
　decision_made / decision_not_made / period_of_silence など  
　初期 record_type を固定し、意味変更を禁止

・なぜ必要か  
　後から言葉の意味が変わると、  
　過去の記録が別物になる

・無いと何が起きるか  
　仕様変更が履歴改変になる  
　時間構造が壊れる

・後回しにしなかった理由  
　意味の固定は v1 でしかできない  
　後付けは必ず破綻する

## 3. サーバ時刻絶対・クライアント非信頼

・機能内容  
　recorded_at はサーバでのみ付与  
　クライアント時刻・ローカル確定を禁止

・なぜ必要か  
　時間順序が揺らぐと、  
　Epoch は成立しない

・無いと何が起きるか  
　環境差によって履歴の解釈が変わる

・後回しにしなかった理由  
　後から制限すると既存データが不正確になる

## 4. オフライン draft 機構

・機能内容  
　オフラインでは下書きのみ保持  
　確定は必ずオンライン

・なぜ必要か  
　入力体験を犠牲にせず、  
　不可逆性を守るため

・無いと何が起きるか  
　オフライン確定が実質的な改変手段になる

・後回しにしなかった理由  
　UX と思想の境界線を v1 で確定する必要がある

## 5. 画像 attachment（Record 従属）

・機能内容  
　画像は Record にのみ紐づく  
　テキスト payload 必須  
　差し替え不可

・なぜ必要か  
　証拠補助は必要だが、  
　意味を語らせてはいけない

・無いと何が起きるか  
　画像単体が物語を作り始める

・後回しにしなかった理由  
　初期から制約しないと  
　後で締めることができない

## 6. プロフィール表層データ分離

・機能内容  
　表示名・プロフィール画像は  
　EpochRecord を生成しない表層データとして扱う

・なぜ必要か  
　自己表現と履歴を混ぜないため

・無いと何が起きるか  
　プロフィール変更が履歴改変に見える

・後回しにしなかった理由  
　設計段階で分離しないと  
　実装が絡まり続ける

## 7. 可視性制御（private / scout / public）

・機能内容  
　Record ごとの公開範囲設定  
　変更は追記 Record として扱う

・なぜ必要か  
　履歴を残すことと  
　見せることは別だから

・無いと何が起きるか  
　記録する勇気が削がれる

・後回しにしなかった理由  
　初期から無いと  
　記録量そのものが減る

## 8. 読み取り課金（Time Window / Session）

・機能内容  
　他人の Epoch を判断材料として読む行為のみ課金

・なぜ必要か  
　Epoch の価値が成立する瞬間がここだから

・無いと何が起きるか  
　無料プロダクトと差別化できない

・後回しにしなかった理由  
　課金前提で UX と構造を作らないと  
　後から歪む

## 9. 削除・編集 API 不在

・機能内容  
　技術的に存在しない

・なぜ必要か  
　「できない」を信頼に変換するため

・無いと何が起きるか  
　内部運用で例外が生まれる

・後回しにしなかった理由  
　後から消すと  
　過去の信頼が崩れる

――――――――――

――――――――――  
ユーザーフロー定義書：Epoch v1  
――――――――――

前提  
このフローは  
「最短で使わせる」ための導線ではない。  
誤読と過剰行動を減らすための最小往復路になる。

## 1. 登録前（Pre-Registration）

状態  
・未認証  
・履歴は存在しない

ユーザー行動  
・Epoch の基本原則を読む  
・評価や要約が存在しないことを理解する  
・登録しないという選択も可能

システム挙動  
・閲覧可能なのは説明ページのみ  
・他人の Epoch には一切触れられない

遷移条件  
・登録を選ぶ → 登録直後へ  
・離脱 → 終了（記録は発生しない）

## 2. 登録直後（Post-Registration）

状態  
・User 作成済み  
・EpochRecord はまだ存在しない

ユーザー行動  
・認証完了（Passkey / Magic Link）  
・表示名・プロフィール画像の設定（任意）

システム挙動  
・User 作成のみ  
・EpochRecord は生成しない

遷移条件  
・初回記録を行う → 初回利用へ  
・何もしない → 沈黙（period_of_silence は自動生成しない）

## 3. 初回利用（First Record）

状態  
・Epoch は空

ユーザー行動  
・decision_made または decision_not_made を記録  
・必要であれば画像を添付  
・確定操作を行う

システム挙動  
・サーバ時刻で EpochRecord を確定  
・record_hash を生成  
・不可逆保存

遷移条件  
・記録確定 → 継続利用へ  
・下書き保存のみ → オフライン／中断状態

## 4. 継続利用（Ongoing Recording）

状態  
・EpochRecord が時間順に存在

ユーザー行動  
・新たな判断・非判断を記録  
・沈黙期間が発生する  
・可視性を変更する（追記として）

システム挙動  
・すべて追記のみ  
・削除・編集 UI は存在しない

遷移条件  
・他人の Epoch を読む必要が生じる → 課金検討へ  
・利用せず時間が経過 → period_of_silence を記録（条件成立時）

## 5. 価値体験（Value Moment）

状態  
・自分の Epoch が時間として積層されている

ユーザー行動  
・過去の自分の判断を振り返る  
・語らずとも残っていることを確認する

システム挙動  
・自己閲覧は常に無料  
・要約や評価は行わない

遷移条件  
・外部判断が必要になる → 課金検討へ  
・不要 → 継続利用へ

## 6. 課金検討（Payment Consideration）

状態  
・他人の Epoch にアクセスしたい状況

ユーザー行動  
・読む目的を自覚する  
・Time Window / Read Session を選択

システム挙動  
・無料では閲覧不可  
・価格は「読む行為」にのみ紐づく

遷移条件  
・支払いを行う → 支払い完了へ  
・支払わない → 自己 Epoch のみ利用継続

## 7. 支払い完了（Post-Payment）

状態  
・読み取り権限が一時的に付与

ユーザー行動  
・他人の Epoch を閲覧  
・判断材料として読む

システム挙動  
・閲覧行為を課金ログとして記録  
・評価・メモ・保存は不可

遷移条件  
・セッション終了 → 再訪へ  
・継続して読む → 課金状態維持

## 8. 再訪（Return）

状態  
・User は存続  
・Epoch は不可逆に保持

ユーザー行動  
・再び記録する  
・再び読む  
・何もしない

システム挙動  
・書き込みと自己閲覧は常に可能  
・課金停止後も履歴は残る

遷移条件  
・新たな判断 → 継続利用へ  
・長期沈黙 → period_of_silence 記録条件を評価

――――――――――

――――――――――  
Done 定義・状態遷移ドキュメント：Epoch v1  
――――――――――

前提  
Epoch における Done は  
達成でも成功でもない。  
条件が満たされ、次の状態へ進めるかどうかだけを扱う。

## 1. User 作成の Done

ユーザーにとっての Done  
・認証が完了し、記録を開始できる状態になった

プロダクト側の Done  
・user_id が発行され、認証手段が有効  
・EpochRecord はまだ存在しない

次の状態  
・初回記録待ち状態へ遷移

## 2. Record 下書きの Done

ユーザーにとっての Done  
・書きたい事実が一通り入力された

プロダクト側の Done  
・draft がローカルに保存されている  
・サーバには何も送信されていない

次の状態  
・確定操作待ち  
・オフライン状態のまま留まることも許可

## 3. Record 確定の Done

ユーザーにとっての Done  
・事実を残したという実感が得られた

プロダクト側の Done  
・サーバ時刻で recorded_at を付与  
・record_hash が生成され、不可逆保存された

次の状態  
・継続利用状態へ遷移  
・以降、この Record は変更不可

## 4. 沈黙期間の Done（period_of_silence）

ユーザーにとっての Done  
・特に操作は行っていない

プロダクト側の Done  
・定義された時間条件を満たした  
・period_of_silence Record が自動生成された

次の状態  
・継続利用状態に留まる

補足  
・沈黙はユーザー操作ではなく、  
　状態の経過によって成立する

## 5. 可視性変更の Done

ユーザーにとっての Done  
・見せる範囲を変えたという認識がある

プロダクト側の Done  
・可視性変更 Record が追記された  
・過去の Record は変更されていない

次の状態  
・継続利用状態へ遷移

## 6. 課金開始の Done

ユーザーにとっての Done  
・読む権利を取得したという認識がある

プロダクト側の Done  
・支払いが完了  
・Time Window / Read Session が有効化

次の状態  
・読み取り可能状態へ遷移

## 7. 課金終了の Done

ユーザーにとっての Done  
・課金が終わったという認識がある  
・利用不能になった感覚は持たない

プロダクト側の Done  
・読み取り権限が失効  
・書き込み・自己閲覧は継続可能

次の状態  
・通常利用状態へ遷移

## 8. 認証復旧の Done

ユーザーにとっての Done  
・再びアクセスできるようになった

プロダクト側の Done  
・auth_recovered Record が追記された  
・復旧経路が監査可能な形で残った

次の状態  
・継続利用状態へ遷移

――――――――――

――――――――――  
課金設計ドキュメント：Epoch v1  
――――――――――

前提  
Epoch の課金は  
利用量の対価でも  
便利機能の対価でもない。  
**判断に伴う不確実性を減らす権利**への対価になる。

## 1. 無料状態の定義

無料でできること  
・EpochRecord の書き込み  
・自己 Epoch の全履歴閲覧  
・可視性の設定と変更  
・沈黙の自動記録

無料でできないこと  
・他人の Epoch を判断材料として読むこと  
・時間全体を横断して他人の履歴を把握すること

無料状態は  
「残す自由」を完全に保証するが  
「読む自由」は保証しない。

## 2. 課金が発生する行為

課金対象は以下に限定される。

・他人の Epoch を  
　判断材料として読む行為

書くこと、残すこと、沈黙することは  
一切課金理由にならない。

## 3. 課金単位の設計意図

許可される課金単位

・Time Window  
　特定期間の Epoch を通読する権利

・Read Session  
　一定時間、Epoch 全体にアクセスする権利

禁止される課金単位

・Record 単体  
・閲覧回数  
・評価や結果に連動した価格

理由  
判断は単発では成立しないため。  
文脈と時間を切り売りすると  
履歴の意味が歪む。

## 4. 支払いによって消える不確実性

支払い前の不確実性

・履歴が編集されていないか  
・評価が混ざっていないか  
・沈黙が欠損していないか  
・後から都合よく整えられていないか

支払い後に消える不確実性

・不可逆であることが保証されている  
・意味付けが行われていない  
・時間順序が絶対である  
・同じ履歴を誰が見ても同一である

ユーザーは  
情報を買っているのではなく  
**歪まない前提条件**を買っている。

## 5. 課金後の行動制限

課金後でもできないこと

・評価を書く  
・要約を生成する  
・保存・抜粋する  
・ランキング的に比較する

理由  
判断行為を  
新たな履歴や評価に変換しないため。

## 6. 課金停止後の扱い

課金停止後も

・書き込みは可能  
・自己閲覧は可能  
・履歴は一切失われない

失われるのは  
「他人の Epoch を読む権利」のみ。

課金は  
人質でも  
継続圧力でもない。

## 7. 課金がお願いにならない条件

以下が守られている限り  
課金はお願いにならない。

・無料でも価値の半分以上が成立している  
・支払い対象が行為として明確  
・支払わなくても人格や信用は下がらない  
・支払った瞬間に条件差が消える

Epoch の課金は  
説得ではなく  
合理的な選択として成立する。

――――――――――

――――――――――  
非機能要件・運用前提ドキュメント：Epoch v1  
――――――――――

前提  
Epoch は  
便利さよりも、  
壊れなかったという事実によって信頼される。  
そのため、振る舞いを先に決めておく。

## 1. 可用性（Availability）

要件  
・書き込み API は高優先度  
・閲覧 API は次点  
・説明ページや補助 UI は低優先度

運用前提  
・一時的に読めなくなることは許容される  
・書けなくなる時間は最小化される

理由  
Epoch の価値は  
「残せなかった」瞬間に最も毀損するため。

## 2. データ永続性（Durability）

要件  
・EpochRecord は不可逆ストレージに保存  
・物理障害を前提に多重化  
・削除・上書き・再計算不可

運用前提  
・バックアップも追記型  
・復元時に record_hash が一致しない場合は公開しない

理由  
壊れた履歴は  
存在しない履歴と同じ。

## 3. 整合性（Consistency）

要件  
・時間順序は絶対  
・部分的な成功は存在しない  
・Record はすべて完全成功か完全失敗

運用前提  
・確定失敗時は Record を生成しない  
・再試行は新しい記録としてのみ許可

理由  
中途半端な事実は  
後から必ず解釈を歪める。

## 4. 障害時の振る舞い

障害発生時  
・書き込み不可の場合は明示的に拒否  
・オフライン確定は絶対に行わない

ユーザーへの表示  
・「保存されていない」ことを曖昧にしない  
・成功したかどうかが不明な状態を作らない

理由  
誤って残ったと信じさせることが  
最大の不正確さになる。

## 5. サポート範囲

提供するサポート  
・ログイン不能時のメール復旧案内  
・明確な不具合の調査

提供しないサポート  
・Record の削除・修正・非表示依頼  
・意味の解釈や評価に関する相談

理由  
運営が意味に介入した瞬間に  
Epoch ではなくなる。

## 6. 運営者権限と責任

運営者に許可されること  
・インフラ運用  
・障害対応  
・監査ログの確認

禁止されること  
・Record の削除  
・Record の修正  
・特定ユーザーへの例外対応

運営者操作も  
すべて監査ログに残る。

## 7. セキュリティ前提

要件  
・認証は Passkey 優先  
・認証復旧は履歴として記録  
・内部アクセスも最小権限

運用前提  
・侵害が発生した場合は事実のみを公開  
・影響範囲と時刻を隠さない

理由  
信頼回復は  
説明ではなく、事実開示でしか起きない。

## 8. 法的・責任境界

Epoch が負う責任  
・記録した事実を改変しないこと  
・保存したデータを消さないこと

Epoch が負わない責任  
・履歴の解釈  
・判断結果  
・第三者間の合意や不合意

理由  
意味は  
常に利用者側に属する。

――――――――――

――――――――――  
仕様書・API 定義・スキーマ定義：Epoch v1  
――――――――――

前提  
・すべて追記型  
・削除／更新 API は存在しない  
・クライアントは状態を持たない  
・サーバが唯一の真実

## 1. データスキーマ定義

### 1.1 User

・user_id  
　UUIDv7  
・created_at  
　UTC / server time  
・auth_credentials  
　passkey / email magic link metadata

制約  
・user_id は再発行不可  
・User 統合 API は存在しない

### 1.2 EpochRecord

・record_id  
　UUIDv7  
・user_id  
　FK → User  
・recorded_at  
　UTC / server time  
・record_type  
　enum  
・payload  
　JSON  
・prev_hash  
　string  
・record_hash  
　string

制約  
・record_hash = hash(record_id + user_id + recorded_at + record_type + payload + prev_hash + attachment_hash?)  
・recorded_at はクライアント指定不可  
・payload のスキーマは record_type ごとに固定

### 1.3 Attachment（Image）

・attachment_id  
・record_id  
・attachment_hash  
・storage_pointer

制約  
・Record なしの attachment 作成不可  
・差し替え不可  
・削除不可

### 1.4 Profile（表層データ）

・user_id  
・display_name  
・avatar_url  
・bio

制約  
・EpochRecord を生成しない  
・履歴保持なし

## 2. API 定義（概要）

### 2.1 認証

POST /auth/register  
POST /auth/login  
POST /auth/recover

制約  
・recover 成功時は auth_recovered Record を自動生成

### 2.2 Record 書き込み

POST /records

入力  
・record_type  
・payload  
・visibility  
・attachment (optional)

サーバ処理  
・recorded_at 付与  
・prev_hash 解決  
・record_hash 生成  
・不可逆保存

失敗時  
・Record は生成されない

### 2.3 Record 取得（自己）

GET /records/self

条件  
・常に無料  
・時間順のみ

### 2.4 Record 取得（他人）

GET /records/{user_id}

条件  
・有効な Read Session / Time Window が必要  
・範囲外アクセスは拒否

### 2.5 可視性変更

POST /records/{record_id}/visibility

処理  
・状態変更 Record を新規生成  
・元 Record は変更しない

### 2.6 課金・セッション

POST /billing/session/start  
POST /billing/session/end

制約  
・Record 単体課金 API は存在しない

## 3. クライアント仕様

### 3.1 Web / Mobile 共通

・状態はサーバ由来のみ  
・ローカル保存は draft のみ  
・recorded_at は表示専用

### 3.2 オフライン挙動

・draft 作成／編集のみ可  
・確定操作は API 成功時のみ Done

## 4. エラーハンドリング方針

・成功／失敗は明確に分離  
・曖昧な中間状態を返さない  
・再試行は新規 POST として扱う

## 5. 監査ログ仕様

・全 API 呼び出しを記録  
・運営者操作も同一形式  
・Record 本体とは分離保存

## 6. 禁止事項（実装レベル）

・DELETE /records  
・PUT /records  
・全文検索 API  
・要約／分析 API  
・ランキング／比較 API

――――――――――

――――――――――  
計測・観測設計ドキュメント：Epoch v1  
――――――――――

前提  
・Epoch の本体（EpochRecord）は改変しない  
・計測は Epoch の意味付けになってはいけない  
・計測データはプロダクト改善のための運用データであり、履歴ではない  
・ユーザーを評価する目的で使わない

## 1. 観測目的（何を知るための計測か）

目的A  
ユーザーが「記録できた」と確信するまでに、どこで詰まるかを知る

目的B  
課金検討から支払い完了までの摩擦点を特定する

目的C  
支払い後に、ユーザーが再訪し継続利用しているかを確認する

目的D  
不可逆性を壊さずに UX を改善できる余地を見つける

## 2. 観測単位（イベントではなく行動単位）

行動単位は以下に限定する。

・Auth 完了  
・Draft 作成  
・Draft 破棄  
・Record 確定成功  
・Record 確定失敗  
・Attachment 追加（確定前）  
・Visibility 変更操作（確定前）  
・Visibility 変更確定（追記 Record 成功）  
・他人 Epoch 閲覧ブロック表示（課金要求）  
・課金開始（session/time window 選択）  
・課金完了  
・他人 Epoch 閲覧開始  
・他人 Epoch 閲覧終了  
・再訪（一定期間後の復帰）

禁止  
・入力テキスト内容の収集  
・payload の解析  
・個人の評価につながる派生指標の生成

## 3. ファネル定義（離脱点の固定）

F1 登録ファネル  
未認証閲覧 → 登録開始 → 認証完了 → 初回 record 確定

観測したい離脱  
・登録開始後に認証完了しない  
・認証完了したが初回 record が確定されない

F2 記録ファネル  
draft 作成 → 確定操作 → 書き込み成功

観測したい離脱  
・draft で止まる  
・確定失敗が連続する

F3 課金ファネル  
他人閲覧要求 → 課金検討 → 課金開始 → 課金完了 → 閲覧開始

観測したい離脱  
・課金検討で止まる  
・課金開始したが完了しない  
・課金完了したが閲覧を開始しない

F4 継続ファネル  
初回記録 → 2回目記録 → 7日内再訪 → 30日内再訪

観測したい離脱  
・初回以降の記録が発生しない  
・再訪はあるが記録がない

## 4. コホート定義（比較のための分割）

・初回記録の有無  
・attachment 利用の有無  
・visibility 設定パターン（private only / public mixed / scout mixed）  
・課金経験の有無  
・read session を使ったか / time window を使ったか

禁止  
・スコア化  
・ランキング化  
・「良いユーザー」定義

## 5. 計測データの保持と扱い

・計測ログは EpochRecord と分離保存  
・保持期間は運用上必要な最小  
・ユーザーが自分の計測ログを履歴として参照する導線は作らない  
・外部共有の際は集計のみ、個票は禁止

## 6. 監視（運用観測）

運用上の必須監視  
・Record 書き込み成功率  
・書き込みレイテンシ  
・record_hash 生成失敗率  
・Attachment 保存失敗率  
・課金開始→完了の成功率  
・閲覧権限チェック失敗率

障害検知の目的は  
UX 改善ではなく、不可逆性の保護が最優先。

## 7. 改善判断の原則（計測の読み方）

・数字が悪いから思想を曲げる、はしない  
・思想を守ったまま、摩擦を減らせる箇所だけを改善する  
・改善は「意味の追加」ではなく「誤操作の削減」に限定する

――――――――――

――――――――――  
課金後ユーザー行動検証レポート：Epoch v1  
――――――――――

前提  
このレポートは  
成功を祝うためのものではない。  
「支払いが合理的だったか」を冷静に確認するための記録になる。  
感想や期待は書かない。観測された行動のみを扱う。

## 1. 検証目的

・支払いが一時的な衝動ではなかったか  
・支払い後に、行動が安定して継続しているか  
・課金によって判断コストが本当に下がったか  
・Epoch の価値が、実利用として成立しているか

ここで Yes と言えなければ  
機能が動いていても Epoch は Done ではない。

## 2. 検証対象ユーザー

対象  
・他人の Epoch に対して  
　Read Session または Time Window を購入したユーザー

除外  
・テストアカウント  
・一度も閲覧行動を開始していない支払い

## 3. 観測期間

最低観測期間  
・支払い当日  
・翌日  
・7日後  
・30日後

理由  
衝動、納得、定着を分離して観測するため。

## 4. 観測項目（行動のみ）

支払い当日  
・閲覧開始が発生したか  
・途中離脱せず、一定時間以上読まれたか

翌日  
・再訪が発生したか  
・自己 Epoch の記録が行われたか

7日後  
・再度の記録行為があったか  
・他人 Epoch の再閲覧要求があったか

30日後  
・継続的な記録が続いているか  
・再課金、もしくは課金検討行動が発生したか

禁止  
・満足度アンケート  
・主観評価の収集  
・「良かった／悪かった」の言語化

## 5. 検証観点

観点A  
支払い後も記録行為が続いているか

→ 続いている場合  
　Epoch は「読むだけの道具」ではなく  
　自分の時間構造にも影響を与えている可能性がある

観点B  
再課金が発生するか

→ 発生している場合  
　価格ではなく、前提条件そのものに価値がある

観点C  
支払い後に離脱していないか

→ 離脱している場合  
　課金導線が誤解を生んでいる  
　価値定義かフローのどこかがズレている

## 6. 失敗とみなす条件

以下のいずれかが成立した場合  
Epoch v1 は Done とみなさない。

・支払い当日の閲覧開始率が極端に低い  
・翌日再訪率が極端に低い  
・支払い後、記録行為が明確に減少する  
・再課金がほぼ発生しない

この場合  
価格調整ではなく  
価値定義ドキュメントに立ち戻る。

## 7. 成立と判断する条件（Epoch v1 Done）

以下が同時に成立していること。

・支払いユーザーの一定割合が翌日も再訪している  
・支払い後も自己 Epoch の記録が継続している  
・再課金が自然発生している  
・課金が「やめたら困る」ではなく  
　「必要なときに選ばれている」

この状態が確認できた時点で  
Epoch v1 は  
思想・構造・実装・運用が一貫した形で  
初めて完成したと判断する。

――――――――――
